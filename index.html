<!-- ppt.html
     Web deck like your screenshot
     ✅ Cover slide before Who we are
     ✅ Start presentation button
     ✅ Tabs, slides, Prev/Next, dots, keyboard, responsive
     ✅ Shows real logos (Tomorrow + Guazi) everywhere
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tomorrow Systems | Guazi — Partnership Deck</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#f6f8ff;
      --bg2:#fff7ea;
      --panel:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow: 0 20px 50px rgba(31,41,55,.12);
      --shadow2: 0 12px 30px rgba(31,41,55,.08);

      --green:#0ea15b;
      --green2:#0b7a46;
      --gold:#f4c84a;
      --blue:#4f6bff;
      --cyan:#2bb4d6;
      --orange:#ff8a5b;

      --radius: 22px;
      --radius2: 16px;

      --maxw: 1080px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(79,107,255,.18), transparent 60%),
        radial-gradient(1000px 600px at 85% 20%, rgba(244,200,74,.22), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,.55);
      border-bottom:1px solid rgba(229,231,235,.7);
    }
    .topbar-inner{
      max-width:var(--maxw);
      margin:0 auto;
      padding:14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 260px;
    }

    /* ✅ Real company logo instead of "TS" */
    .logo{
      width:34px; height:34px;
      border-radius:10px;
      background: rgba(255,255,255,.9);
      border:1px solid rgba(229,231,235,.9);
      display:grid;
      place-items:center;
      overflow:hidden;
      box-shadow: 0 8px 18px rgba(31,41,55,.06);
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .brand-title{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
    }
    .pill{
      font-size:12px;
      color:var(--muted);
      padding:6px 10px;
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.8);
      border-radius:999px;
    }

    .nav-actions{
      display:flex; align-items:center; gap:10px;
    }
    .btn{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.85);
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      color:#111827;
      display:inline-flex; align-items:center; gap:8px;
      box-shadow: 0 8px 18px rgba(31,41,55,.06);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 14px 24px rgba(31,41,55,.10); }
    .btn:active{ transform: translateY(0px); }
    .btn.primary{
      border-color: rgba(244,200,74,.8);
      background: rgba(244,200,74,.18);
    }
    .kbd{
      font-size:12px;
      padding:3px 8px;
      border-radius:8px;
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.85);
      color: var(--muted);
    }

    /* Main deck */
    .wrap{
      max-width:var(--maxw);
      margin: 28px auto 70px;
      padding: 0 18px;
    }

    .deck{
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(229,231,235,.8);
      border-radius: calc(var(--radius) + 10px);
      box-shadow: var(--shadow);
      padding: 24px;
    }

    /* Tabs like your screenshot */
    .tabs{
      display:flex; align-items:center; gap:10px;
      padding: 8px 6px 18px;
      flex-wrap:wrap;
    }
    .tab{
      padding: 9px 12px;
      border-radius:999px;
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.75);
      color: var(--muted);
      font-weight:600;
      cursor:pointer;
      transition: background .12s ease, transform .12s ease;
      user-select:none;
    }
    .tab:hover{ transform: translateY(-1px); }
    .tab.active{
      color:#111827;
      border-color: rgba(244,200,74,.85);
      background: rgba(244,200,74,.20);
    }

    /* Slide header */
    .slide-head{
      padding: 8px 8px 14px;
    }
    .h1{
      font-family: Arial, sans-serif;
      font-size: 44px;
      line-height: 1.05;
      margin: 6px 0 6px;
      letter-spacing: .2px;
      color: #0f172a;
    }
    .h1 .accent{ color: var(--green2); }
    .sub{
      color: var(--muted);
      font-size: 16px;
      line-height: 1.6;
      margin: 0 0 12px;
      max-width: 820px;
    }
    .slide-extra{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.72);
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: var(--shadow2);
      max-width: 900px;
      margin-bottom: 10px;
    }
    .extra-title{
      font-size: 14px;
      font-weight: 700;
      color:#111827;
    }
    .extra-sub{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }
    .extra-list{
      margin: 8px 0 0;
      padding-left: 18px;
      font-size: 12px;
      column-count: 2;
      column-gap: 18px;
    }
    .extra-list li{
      margin: 4px 0;
      line-height: 1.35;
      break-inside: avoid;
    }
    @media (max-width: 760px){
      .extra-list{ column-count: 1; }
    }
    .callout{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.72);
      border-radius: 14px;
      padding: 12px 14px;
      color:#111827;
      font-weight:600;
      box-shadow: var(--shadow2);
      max-width: 900px;
    }

    /* Content grid */
    .grid{
      display:grid;
      grid-template-columns: 1.35fr .85fr;
      gap: 18px;
      margin-top: 16px;
    }
    .grid.single{
      grid-template-columns: 1fr;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width:unset; }
      .h1{ font-size: 36px; }
    }

    .panel{
      background: rgba(255,255,255,.8);
      border: 1px solid rgba(229,231,235,.85);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow2);
    }
    .panel-title{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .panel-title h3{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
      color:#111827;
    }
    .tag{
      font-size:12px;
      color: var(--muted);
      padding: 5px 10px;
      border: 1px solid rgba(229,231,235,.9);
      border-radius: 999px;
      background: rgba(255,255,255,.75);
    }

    /* Bullet list */
    .bullets{
      margin: 10px 0 0;
      padding-left: 18px;
      color:#111827;
    }
    .bench{
      display:grid;
      gap:10px;
      margin-top: 6px;
    }
    .bench-list{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .bench-item{
      text-align:center;
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.78);
      width:32px;
      height:32px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 12px;
      color:#111827;
      cursor: pointer;
      display:grid;
      place-items:center;
    }
    .bench-item.active{
      border-color: rgba(244,200,74,.85);
      background: rgba(244,200,74,.20);
    }
    .bench-detail{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.8);
      border-radius: var(--radius2);
      padding: 10px 12px;
      box-shadow: var(--shadow2);
    }
    .bench-title{
      font-size: 13px;
      font-weight: 700;
      color:#111827;
      margin-bottom: 4px;
    }
    .bench-meta{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .bench-cols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .bench-sub{
      font-size: 12px;
      font-weight: 700;
      color:#111827;
      margin-bottom: 4px;
    }
    .bench-ul{
      margin: 0;
      padding-left: 16px;
      font-size: 12px;
      color:#111827;
    }
    .bench-note{
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.4;
    }
    @media (max-width: 520px){
      .bench-cols{ grid-template-columns: 1fr; }
    }
    .left-media{
      margin-top: 6px;
      border:1px solid rgba(229,231,235,.85);
      border-radius: var(--radius);
      background: rgba(255,255,255,.85);
      box-shadow: var(--shadow2);
      overflow: hidden;
      position: relative;
    }
    .left-media img{
      width:100%;
      height:auto;
      display:block;
      object-fit: contain;
      cursor: zoom-in;
    }
    .left-media-next{
      position:absolute;
      right:12px;
      top:50%;
      transform: translateY(-50%);
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.92);
      width:36px;
      height:36px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      display: grid;
      place-items: center;
      box-shadow: 0 10px 22px rgba(31,41,55,.12);
    }
    .img-next{
      position:absolute;
      right:10px;
      top:50%;
      transform: translateY(-50%);
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.92);
      width:30px;
      height:30px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      display: grid;
      place-items: center;
      box-shadow: 0 10px 22px rgba(31,41,55,.12);
      z-index: 2;
    }
    .bullets li{
      margin: 8px 0;
      line-height: 1.55;
    }
    .muted{ color:var(--muted); }

    /* Stats cards */
    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 520px){ .stats{ grid-template-columns: 1fr; } }

    .gaps-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .gap-card{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.78);
      border-radius: var(--radius2);
      padding: 12px;
      box-shadow: 0 10px 22px rgba(31,41,55,.06);
    }
    .gap-title{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    .gap-value{
      font-size: 18px;
      font-weight: 800;
      color:#111827;
      margin-top: 2px;
    }
    .gap-note{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    @media (max-width: 520px){ .gaps-grid{ grid-template-columns: 1fr; } }

    .stat{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.78);
      border-radius: var(--radius2);
      padding: 14px;
      box-shadow: 0 10px 22px rgba(31,41,55,.06);
      position:relative;
      overflow:hidden;
    }
    .stat::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(500px 120px at 10% 0%, rgba(14,161,91,.12), transparent 55%),
                  radial-gradient(420px 120px at 80% 10%, rgba(79,107,255,.10), transparent 55%);
      pointer-events:none;
    }
    .stat .k{
      position:relative;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 600;
    }
    .stat .v{
      position:relative;
      font-size: 26px;
      font-weight: 800;
      color:#0f172a;
      letter-spacing: .2px;
    }
    .stat .note{
      position:relative;
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    .growth-card{
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.78);
      border-radius: var(--radius2);
      padding: 14px;
      box-shadow: 0 10px 22px rgba(31,41,55,.06);
      margin-top: 12px;
    }
    .growth-title{
      font-size: 14px;
      font-weight: 700;
      color:#111827;
    }
    .growth-sub{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }
    .growth-table{
      width:100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 12px;
    }
    .growth-table th,
    .growth-table td{
      text-align:left;
      padding: 6px 0;
    }
    .growth-table th{
      color: var(--muted);
      font-weight: 600;
    }
    .growth-table td{
      border-top:1px dashed rgba(148,163,184,.35);
      color:#0f172a;
    }
    .growth-table td.growth-value{
      font-weight: 700;
    }
    .growth-note{
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.4;
    }
    @media (max-width: 520px){
      .growth-card{ padding: 12px; }
      .growth-table{ font-size: 11px; }
    }

    /* Images panel */
    .imgbox{
      display:grid;
      gap: 12px;
    }
    .img{
      width:100%;
      aspect-ratio: 16/9;
      border-radius: var(--radius);
      border:1px dashed rgba(148,163,184,.7);
      background: rgba(255,255,255,.65);
      display:grid;
      place-items:center;
      color: var(--muted);
      font-weight: 700;
      overflow:hidden;
      position:relative;
    }
    .img.chart{
      aspect-ratio: 860 / 320;
      background: rgba(255,255,255,.9);
      border-style: solid;
    }
    .img canvas{
      width:100%;
      height:100%;
      display:block;
    }
    .img img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .img small{
      position:absolute;
      bottom:10px; left:12px;
      padding: 6px 10px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(229,231,235,.85);
      border-radius:999px;
      font-size:12px;
      color:#111827;
      backdrop-filter: blur(8px);
    }
    .img.clickable img{ cursor: zoom-in; }
    .img.is-logo{
      background: rgba(255,255,255,.9);
      border-style: solid;
    }
    .img.is-logo img{
      width: 62%;
      height: 62%;
      object-fit: contain;
    }
    .chart-block{
      border:1px solid rgba(229,231,235,.85);
      border-radius: var(--radius);
      background: rgba(255,255,255,.85);
      box-shadow: var(--shadow2);
      padding: 12px;
    }
    .chart-title{
      font-size: 13px;
      font-weight: 700;
      color:#111827;
      margin: 2px 0 10px;
    }
    .chart-canvas{
      width:100%;
      height:auto;
      aspect-ratio: 860 / 320;
      display:block;
      cursor: zoom-in;
    }
    .chart-canvas.bar{
      aspect-ratio: 860 / 240;
    }

    /* Lightbox */
    .lightbox{
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,.55);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .16s ease;
      z-index: 60;
      padding: 24px;
    }
    .lightbox.open{
      opacity: 1;
      pointer-events: auto;
    }
    .lightbox img{
      max-width: min(92vw, 1100px);
      max-height: 82vh;
      border-radius: 18px;
      background: #fff;
      box-shadow: var(--shadow);
    }
    .lightbox .lightbox-close{
      position: absolute;
      top: 16px;
      right: 16px;
      border: 1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.9);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Footer controls */
    .footer{
      margin-top: 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }
    .progress{
      display:flex; align-items:center; gap:6px;
      flex-wrap:wrap;
    }
    .dot{
      width:10px; height:10px;
      border-radius:99px;
      border:1px solid rgba(148,163,184,.65);
      background: rgba(255,255,255,.55);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    .dot:hover{ transform: translateY(-1px); }
    .dot.active{
      background: rgba(14,161,91,.55);
      border-color: rgba(14,161,91,.75);
    }
    .meta{
      color: var(--muted);
      font-size: 13px;
      display:flex; align-items:center; gap:10px;
    }

    /* ✅ Cover slide special layout */
    .cover-wrap{
      display:grid;
      gap:16px;
    }
    .cover-image{
      width:100%;
      border-radius: var(--radius);
      overflow:hidden;
      border:1px solid rgba(229,231,235,.85);
      background: rgba(255,255,255,.7);
      box-shadow: var(--shadow2);
      aspect-ratio: 16/7;
    }
    .cover-image img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }
    .cover-logos{
      display:flex;
      justify-content:center;
      gap:16px;
      flex-wrap:wrap;
      padding:14px;
      border-radius: var(--radius);
      border:1px solid rgba(229,231,235,.85);
      background: rgba(255,255,255,.72);
      box-shadow: var(--shadow2);
    }
    .cover-logos .logo-card{
      background:white;
      border:1px solid rgba(229,231,235,.85);
      border-radius: 16px;
      padding: 12px 16px;
      box-shadow: 0 10px 22px rgba(31,41,55,.06);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .cover-logos img{
      height: 54px;
      width:auto;
      display:block;
    }
    .start-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 12px 18px;
      border-radius: 999px;
      border:1px solid rgba(244,200,74,.85);
      background: linear-gradient(135deg, rgba(244,200,74,.26), rgba(79,107,255,.18));
      font-weight: 800;
      cursor:pointer;
      box-shadow: 0 14px 26px rgba(31,41,55,.10);
      transition: transform .12s ease, box-shadow .12s ease;
      user-select:none;
    }
    .start-btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 34px rgba(31,41,55,.14); }

    /* Print */
    @media print{
      .topbar, .footer{ display:none !important; }
      body{ background: #fff; }
      .deck{ box-shadow:none; border:1px solid #ddd; }
    }
  </style>
</head>
<body>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <!-- ✅ Real logo -->
        <div class="logo" title="Tomorrow Systems">
          <img src="assets/tomorrow.jpeg" alt="Tomorrow Systems Logo">
        </div>
        <div class="brand-title">
          <span class="pill">Tomorrow Systems</span>
          <span class="pill">Guazi</span>
          <span class="pill">Partnership Deck</span>
        </div>
      </div>

      <div class="nav-actions">
        <button class="btn" id="btnPrev">← Prev <span class="kbd">←</span></button>
        <button class="btn primary" id="btnNext">Next → <span class="kbd">→</span></button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="deck">
      <div class="tabs" id="tabs"></div>

      <div class="slide-head">
        <div class="h1" id="title">—</div>
        <p class="sub" id="subtitle"></p>
        <div class="slide-extra" id="slideExtra" style="display:none;"></div>
        <div class="callout" id="callout" style="display:none;"></div>

        <!-- ✅ Cover-only elements -->
        <div class="cover-wrap" id="coverArea" style="display:none;">
          <div class="cover-image">
            <img src="assets/guazi logo (1).svg" alt="Guazi logo">
          </div>

          <div class="cover-logos">
            <div class="logo-card"><img src="assets/tomorrow.jpeg" alt="Tomorrow Systems"></div>
          </div>

        </div>
      </div>

      <div class="grid" id="mainGrid">
        <div class="panel">
          <div class="panel-title" id="panelTitleLeftWrap">
            <h3 id="panelTitleLeft">Key points</h3>
            <span class="tag" id="panelTagLeft">Overview</span>
          </div>

          <div class="left-media" id="leftMedia" style="display:none;"></div>
          <div class="bench" id="benchmarkWrap" style="display:none;"></div>
          <ul class="bullets" id="bullets"></ul>
          <div class="growth-card" id="growthCard" style="display:none;"></div>
          <div class="gaps-grid" id="gaps" style="display:none;"></div>
          <div class="stats" id="stats"></div>
        </div>

        <div class="panel" id="rightPanel">
          <div class="panel-title">
            <h3 id="panelTitleRight">Evidence</h3>
            <span class="tag" id="panelTagRight">Charts / Images</span>
          </div>

          <div class="imgbox" id="images"></div>
          <div class="muted" style="margin-top:10px;font-size:12px;line-height:1.5" id="sources"></div>
        </div>
      </div>

      <div class="footer">
        <div class="progress" id="progress"></div>
        <div class="meta">
          <span id="slideIndex">Slide 1 / 1</span>
          <span class="kbd">Home</span> start
          <span class="kbd">End</span> last
        </div>
      </div>
    </section>
  </main>

  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lightbox-close" id="lightboxClose" type="button" aria-label="Close image">Close</button>
    <img id="lightboxImg" alt="">
  </div>

  <script>
    // ===========================
    // SLIDES
    // ✅ Added COVER slide BEFORE Who we are
    // ===========================
    const SLIDES = [
      {
        id: "cover",
        tab: "Morocco & Africa",
        isCover: true,
        title: "Tomorrow Systems <span class='accent'>|</span> Guazi",
        subtitle: "Deployment of a structured used-car ecosystem in Morocco & Africa.",
        callout: "We are not building a platform from scratch — we are deploying a proven one, locally adapted."
      },
      {
        id: "summary",
        tab: "Morocco & Africa",
        title: "Summary",
        subtitle: "Deck flow at a glance.",
        callout: "Summary: seven sections build the case for a Morocco pilot. Context = market situation + actors + gaps.",
        hideRightPanel: true,
        leftTag: "Agenda",
        bullets: [
          "<b>01</b> Who we are",
          "<b>02</b> Context",
          "<b>03</b> Benchmark",
          "<b>04</b> The Gap to Fix",
          "<b>05</b> Why Guazi",
          "<b>06</b> Further with Guazi",
          "<b>07</b> Why Morocco as a pilot gateway"
        ]
      },

      {
        id: "who-we-are",
        tab: "Morocco & Africa",
        title: "Who we are — <span class='accent'>Tomorrow Systems</span>",
        subtitle: "Smart mobility & digital infrastructure company delivering mission-critical urban systems across Morocco and Africa.",
        callout: "We deliver complex infrastructure + software programs: from design and commissioning to operations and asset performance.",
        hideRightPanel: true,
        leftTag: "Company snapshot",
        rightTag: "Proof points",
        bullets: [
          "<b>Smart City & Mobility specialist</b> (traffic, urban mobility, field devices, operations).",
          "<b>End-to-end delivery</b>: planning → deployment → testing/commissioning → O&M support.",
          "<b>Public infrastructure DNA</b>: built for reliability, governance, and scale.",
          "<span class='muted'>Positioning:</span> bridging engineering execution with digital platforms and data."
        ],
        leftImages: [
          { src: "assets/4.png", alt: "Key points snapshot" },
          { src: "assets/7.png", alt: "Key points snapshot 2" }
        ],
        growth: {
          title: "Confirmed portfolio growth",
          subtitle: "Portfolio value (MAD)",
          rows: [
            { year: "2021", value: "300M MAD" },
            { year: "2022", value: "350M MAD" },
            { year: "2023", value: "420M MAD" },
            { year: "2024", value: "505M MAD" },
            { year: "2025", value: "2.7B MAD" },
            { year: "2026*", value: "3.4B MAD" }
          ],
          note: "Source: internal portfolio figures (Tomorrow Systems materials)."
        },
        stats: [
          { k: "Smart intersections (example scope)", v: "300+", note: "Traffic signalization & mobility deployments (portfolio scale)." },
          { k: "Operations mindset", v: "O&M", note: "Asset management, assistance, maintenance planning." },
        ],
        images: [
          { label: "what we do in smart city", src: "assets/Company Mobility.png" },
          { label: "WE DO", src: "assets/Portfolio scale.png" },
        ],
        sources: [
          "Internal portfolio figures and project references (Tomorrow Systems materials)."
        ]
      },
      {
        id: "market-context",
        tab: "Strategic Deployment",
        title: "Context",
        subtitle: "A structurally growing automotive market with accelerating Chinese brand adoption and EV/hybrid momentum.",
        callout: "The market is growing in volume and technology — but trust, standards, and transaction structure lag behind.",
        leftTag: "Growth & adoption",
        rightTag: "Evidence",
        bullets: [
          "<b>2024 total market size</b>: 176,401 units <span class='muted'>(+9.2% YoY)</span>.",
          "<b>Oct total sales (VP+VUL)</b>: 2023 14,111 · 2024 15,003 · 2025 19,561.",
          "<b>Chinese brands share</b>: ~32% of total sales <span class='muted'>(estimate — to be validated, TBC)</span>.",
          "<b>NEV adoption (2024)</b>: 11,134 units, 6.3% share <span class='muted'>(hybrid-led)</span>."
        ],
        stats: [
          { k: "Total market 2024", v: "176,401", note: "+9.2% YoY" },
          { k: "NEV 2024", v: "11,134", note: "6.3% share (hybrid-led)" },
          { k: "Oct 2025 total", v: "19,561", note: "VP+VUL (Oct 2025)" },
          { k: "Chinese brands share (est.)", v: "Up to ~25%", note: "Estimate — to be validated (TBC)" }
        ],
        trend: {
          months: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
          series: [
            { name: "2024", data: [12425,10702,12618,14022,12971,14316,15498,18287,14626,15003,14039,22622], color: "#0ea15b" },
            { name: "2023", data: [11821,12265,13047,11391,10849,13317,14233,14191,13411,14111,12743,17518], color: "#4f6bff" },
            { name: "2022", data: [12527,13947,12773,12117,10527,11286,12504,12913,13269,13358,12266,16121], color: "#94a3b8" }
          ],
          cumul: [
            { label: "2024", value: 137953, color: "#0ea15b" },
            { label: "2025", value: 186415, color: "#ff8a5b" }
          ],
          oct: [
            { label: "Oct 2023", value: 14111 },
            { label: "Oct 2024", value: 15003 },
            { label: "Oct 2025", value: 19561 }
          ]
        },
        images: [
          {
            frames: [
              { label: "Monthly VP+VUL (2022–2024)", chart: "trend_line" },
              { label: "Cumul Jan–Oct (2024–2025)", chart: "trend_cumul" }
            ]
          },
          {
            frames: [
              { label: "Chinese brands in Morocco (infographic)", src: "assets/Chinese brands in Morocco.png" },
              { label: "Top 10 Chinese cars (infographic)", src: "assets/Top 10 Chinese cars.png" }
            ]
          }
        ],
        sources: [
          "AIVAM 2024 report (total market + NEV).",
          "AIVAM Oct 2025 release (Oct 2025 + cumul Jan–Oct 2025).",
          "Chinese brands share is an industry estimate (not AIVAM official)."
        ]
      },


      {
        id: "benchmark",
        tab: "Used-Car Ecosystem",
        title: "Benchmark",
        subtitle: "Validated benchmark of the Moroccan used-car ecosystem.",
        callout: "The Moroccan used-car market is liquid and digital, but fragmented, informal, and trust-deficient — no player owns the full transaction lifecycle. Many actors are middlemen/brokers, and used-car supply is mostly European.",
        leftTag: "Channel map",
        rightTag: "Limits & gaps",
        benchmarkItems: [
          {
            title: "1) Open marketplaces (C2C / low structure)",
            short: "1) Open marketplaces",
            examples: "Avito, Moteur.ma, Facebook Marketplace / groups",
            strengths: ["High visibility & traffic", "Strong filters, fast reach"],
            limits: ["No seller responsibility", "High fraud exposure", "No mandatory inspection/verification (some listings may show optional expertise reports)", "Actors are mostly intermediaries (middlemen / brokers)."],
           
          },
          {
            title: "2) Digital used-car marketplaces ",
            short: "2) Digital marketplaces",
            examples: "Autocaz (Auto Hall), Kifal Auto, AUTO24.ma, Renew Maroc, GlobalOccaz",
            strengths: ["Better UX than C2C", "Some inspection or certification logic", "Price guidance / estimation", "Higher trust than Avito/Facebook"],
            limits: ["Limited diagnosis history (no full lifecycle records)", "Limited approval based on inspection (not strict pass/fail)", "Inspection standards not unified", "Logistics + import not totally covered", "Responsibility unclear post-delivery"],
           
          },
          {
            title: "3) Manufacturer-backed certified networks",
            short: "3) Certified networks",
            examples: "SPOTICAR Maroc, Auto Hall (via Autocaz)",
            strengths: ["Brand trust", "Certified vehicles", "Warranty & after-sales", "Physical showrooms"],
            limits: ["Higher prices", "Limited brand scope", "Closed ecosystems", "Domestic focus only", "Manufacturer → dealership changes can be complex"],
          
          },
          {
            title: "4) Brokers & middlemen (informal but dominant)",
            short: "4) Brokers & middlemen",
            strengths: ["Speed & negotiation", "Market knowledge"],
            limits: ["Informal & opaque", "Conflicts of interest", "No inspection standard", "No liability"],
           
          },
          {
            title: "5) Garages & inspection services",
            short: "5) Garages & inspection",
            strengths: ["Widely available", "Low cost"],
            limits: ["No national standard", "Variable report quality", "No accountability if mismatch", "Limited diagnostic history."],
           
          },
          {
            title: "6) Financing & insurance (disconnected layer)",
            short: "6) Financing & insurance",
            examples: "Banks, leasing companies, insurers",
            strengths: ["Financing and insurance products do exist in the market", "Banks and leasing actors are experienced and regulated", "Insurance coverage is mandatory and well-structured", "Strong institutional players with risk management frameworks"],
            limits: ["Not integrated into the transaction flow (financing comes late)", "Loan approval not linked to vehicle inspection or condition", "Complex and slow approval process for buyers", "Limited access to financing outside certified dealer networks", "No end-to-end coordination with marketplaces or inspection actors"],
           
          }
        ],
        images: [
          {
            frames: [
              { label: "Buyer journey map", src: "assets/Buyer%20journey%20map.png" },
              { label: "Channel map (add)", src: "assets/Channel map.png" }
            ]
          },
          { label: "Fragmentation visual (add)", src: "assets/Fragmentation visual.png" },
        ],
        sources: [
          "Validated benchmark: Avito, Facebook Marketplace/groups, Autocaz, Kifal Auto, AUTO24.ma, OtoClic, SuperOccaz, Global Occaz, Renew Maroc, Siaracash, SPOTICAR Maroc, Auto Hall."
        ]
      },

      {
        id: "missing",
        tab: "Used-Car Ecosystem",
        title: "The Gap to Fix",
        subtitle: "The missing layer is trust infrastructure: verification, standards, pricing intelligence, and end-to-end accountability.",
        callout: "The market has components — but lacks integration, standardization, and preventive protection.",
        leftTag: "Trust stack gaps",
        rightTag: "Evidence",
        bullets: [
          "<b>Verified seller + vehicle identity</b> before a “trusted” listing.",
          "<b>Unified inspection standard</b> + grading.",
          "<b>Reference pricing intelligence</b> (model/year/mileage/condition/city).",
          "<b>Preventive fraud protection</b> (not only warnings).",
          "<b>End-to-end accountability</b>: discovery → inspection → financing → paperwork → handover + post-sale.",
          "<b>Diagnosis history is limited today</b> — need lifecycle records.",
          "<b>Approval based on inspection is weak</b> — need strict pass/fail rules."
        ],
        trustGaps: [
          { title: "Verification", value: "Missing", note: "Upfront identity + vehicle checks." },
          { title: "Standardization", value: "Missing", note: "Comparable inspections & grading." },
          { title: "Transparency", value: "Missing", note: "Price intelligence & fair value." },
          { title: "Process flow", value: "Missing", note: "Steps are not connected." }
        ],
        images: [
          {
            frames: [
              { label: "Trust stack diagram", src: "assets/Trust stack diagram.png" },
              { label: "Standard inspection report mock", src: "assets/Standard inspection report mock.png" }
            ]
          }
        ],
        sources: [
          "Benchmark conclusion from market structure: components exist, trust layer missing."
        ]
      },

      {
        id: "why-guazi",
        tab: "Strategic Deployment",
        title: "Why <span class='accent'>Guazi</span>",
        subtitle: "China moved from distrust to global confidence — Guazi comes from a mature ecosystem that solved used-car trust at scale.",
        callout: "10–15 years ago: skepticism. Today: proven quality + modern tech + massive market maturity.",
        leftTag: "Trust shift",
        rightTag: "Guazi value",
        bullets: [
          "<b>Trust evolution & acceptability</b>: Chinese automotive quality improved dramatically; consumers now trust Chinese brands for value + tech.",
          "<b>China is a mature automotive ecosystem</b>: intense competition forces high standards.",
          "<b>Guazi is built for used-car trust</b>: inspection logic, pricing intelligence, transaction control.",
          "<b>Proven at scale</b>: experience from a market with huge transaction volumes and operational complexity.",
          "<b>Know-how transfer</b>: processes, playbooks, and tech patterns adaptable to local reality.",
          "<b>Export readiness know-how</b>: structured workflow from inspection to export shipment.",
          "<b>Operational maturity at scale</b>: repeatable SOPs built for high transaction volumes.",
          "<b>Inspection & liability control</b>: standardized inspections with evidence chain (photos/time stamps).",
          "<b>Logistics clarity</b>: Incoterms support (recommend CIF), insurance options, and clear risk transfer.",
          "<b>Further with Guazi</b>: go further with a proven operating partner.",
          "<b>Reliable</b>: disciplined execution and consistency at scale.",
          "<b>Available</b>: execution-ready teams and playbooks."
        ],
        stats: [
          { k: "Chinese brands share (Morocco)", v: "Up to ~25%", note: "Internal estimate — validate for external use." },
          { k: "Growth signal", v: "+240%", note: "Example YoY jump highlighted in infographic." }
        ],
        images: [
          { label: "Guazi logo", src: "assets/guazi logo (1).svg" },
          { label: "Add another visual here", src: "assets/Add another visual here.png" },
        ],
        sources: [
          "Internal notes  — validate for external publishing.",
          "Use shared visuals + confirm with official sources when publishing externally."
        ]
      },

      {
        id: "objectives",
        tab: "Strategic Deployment",
        title: "Further with <span class='accent'>Guazi</span>",
        subtitle: "Transfer proven know-how to accelerate trust, standards, and efficiency — building a locally adapted, scalable ecosystem.",
        callout: "",
        leftTag: "Objectives",
        rightTag: "KPIs (examples)",
        bullets: [
          "<b>Objective</b>: launch Otomall with Guazi know-how (trust + inspection + pricing + ops).",
          "<b>Transfer proven operating model</b>: adopt tested processes, not experiments.",
          "<b>Build trust architecture</b>: verification, inspection standard, and transparent pricing.",
          "<b>Reduce friction</b>: shorten buyer journey and increase conversion.",
          "<b>Raise market standards</b>: consistent quality expectations and reporting.",
          "<b>Create a scalable model</b>: pilot → replicate across regions."
        ],
        stats: [
          { k: "Time-to-market", v: "Faster", note: "Avoid years of trial-and-error." },
          { k: "Trust goal", v: "Higher", note: "Structured checks + standards." },
          { k: "Reliability", v: "Reliable", note: "Disciplined execution and consistency at scale." },
          { k: "Availability", v: "Available", note: "Execution-ready teams and playbooks." }
        ],
        images: [
          { label: "Roadmap visual (add)", src: "assets/Roadmap visual.png" },
          { label: "KPIs dashboard mock (add)", src: "assets/KPIs dashboard mock.png" },
        ],
        sources: [
          "Objectives derived from market gaps: trust, standardization, integration."
        ]
      },

      {
        id: "morocco-gateway",
        tab: "Morocco & Africa",
        title: "Why Morocco as a <span class='accent'>pilot gateway</span>",
        subtitle: "Morocco combines strategic geography, world-class logistics, and a mature automotive ecosystem — ideal to test and scale.",
        callout: "Pilot where infrastructure exists and outcomes are measurable — then expand through Morocco’s Africa gateway position.",
        leftTag: "Strategic reasons",
        rightTag: "Logistics hubs",
        bullets: [
          "<b>Geographic bridge</b>: direct link Europe ↔ Africa (Atlantic + Mediterranean routes).",
          "<b>World-class ports</b>: Tanger Med + Casablanca; plus emerging hubs (Nador West Med) and future Atlantic gateway (Dakhla).",
          "<b>Automotive export capability</b>: mature logistics, customs, compliance culture.",
          "<b>Market is big but controllable</b>: meaningful volume, manageable complexity for pilot tuning.",
          "<b>Gateway to West & Francophone Africa</b>: success becomes a replicable reference."
        ],
        stats: [
          { k: "Automotive exports", v: "~1M/yr", note: "Macro signal — validate with final source set for client." },
          { k: "Gateway value", v: "EU ↔ Africa", note: "Strategic bridge positioning." }
        ],
        images: [
          { label: "Ports / logistics map (add)", src: "assets/Ports logistics map.png" },
          { label: "Whiteboard notes visual (optional)", src: "assets/Whiteboard notes visual.png" },
        ],
        sources: [
          "Ports: Tanger Med / Casablanca / Nador West Med / Dakhla."
        ]
      },
      {
        id: "closing-image",
        tab: "Morocco & Africa",
        title: "",
        subtitle: "",
        callout: "",
        imageOnly: true,
        leftImage: {
          src: "assets/5.png",
          alt: "Slide image"
        }
      }
    ];

    // Tabs derived from slides
    const TAB_ORDER = [...new Set(SLIDES.map(s => s.tab))];

    // ===========================
    // Rendering logic
    // ===========================
    const $ = sel => document.querySelector(sel);

    const tabsEl = $("#tabs");
    const titleEl = $("#title");
    const subtitleEl = $("#subtitle");
    const calloutEl = $("#callout");
    const extraEl = $("#slideExtra");

    const bulletsEl = $("#bullets");
    const statsEl = $("#stats");
    const growthEl = $("#growthCard");
    const gapsEl = $("#gaps");
    const leftTitleWrapEl = $("#panelTitleLeftWrap");
    const leftMediaEl = $("#leftMedia");
    const benchmarkEl = $("#benchmarkWrap");
    const imagesEl = $("#images");
    const sourcesEl = $("#sources");
    const lightboxEl = $("#lightbox");
    const lightboxImgEl = $("#lightboxImg");
    const lightboxCloseEl = $("#lightboxClose");

    const leftTagEl = $("#panelTagLeft");
    const rightTagEl = $("#panelTagRight");

    const progressEl = $("#progress");
    const slideIndexEl = $("#slideIndex");

    const coverAreaEl = $("#coverArea");
    const mainGridEl = $("#mainGrid");
    const rightPanelEl = $("#rightPanel");

    let idx = 0;
    const leftMediaIndex = {};
    const rightMediaIndex = {};
    const benchIndex = {};

    function buildTabs(){
      tabsEl.innerHTML = "";
      TAB_ORDER.forEach(tabName => {
        const btn = document.createElement("button");
        btn.className = "tab";
        btn.textContent = tabName;
        btn.onclick = () => {
          const first = SLIDES.findIndex(s => s.tab === tabName);
          if (first >= 0) setSlide(first);
        };
        tabsEl.appendChild(btn);
      });
    }

    function buildProgress(){
      progressEl.innerHTML = "";
      SLIDES.forEach((_, i) => {
        const d = document.createElement("div");
        d.className = "dot";
        d.title = `Go to slide ${i+1}`;
        d.onclick = () => setSlide(i);
        progressEl.appendChild(d);
      });
    }

    function setActiveTabs(tabName){
      [...tabsEl.children].forEach(t => {
        t.classList.toggle("active", t.textContent === tabName);
      });
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function formatNum(n){
      return String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function setupCanvas(canvas, width, height){
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.round(width * dpr);
      canvas.height = Math.round(height * dpr);
      canvas.style.width = "100%";
      canvas.style.height = "auto";
      const ctx = canvas.getContext("2d");
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      ctx.clearRect(0, 0, width, height);
      return { ctx, width, height };
    }

    function drawLineChart(ctx, width, height, series, labels){
      if (!series.length || !labels.length) return;
      const pad = { l: 54, r: 16, t: 20, b: 34 };
      const plotW = width - pad.l - pad.r;
      const plotH = height - pad.t - pad.b;
      const maxVal = Math.max(...series.flatMap(s => s.data));
      const yMax = Math.ceil(maxVal / 1000) * 1000;
      const yMin = 0;
      const gridCount = 4;

      ctx.font = "11px 'Space Grotesk', system-ui, sans-serif";
      ctx.fillStyle = "#6b7280";
      ctx.strokeStyle = "rgba(148,163,184,.35)";
      ctx.lineWidth = 1;
      for (let i = 0; i <= gridCount; i++){
        const t = i / gridCount;
        const y = pad.t + plotH * (1 - t);
        ctx.beginPath();
        ctx.moveTo(pad.l, y);
        ctx.lineTo(pad.l + plotW, y);
        ctx.stroke();
        const val = Math.round(yMin + (yMax - yMin) * t);
        ctx.fillText(formatNum(val), 6, y + 4);
      }

      labels.forEach((label, i) => {
        const x = pad.l + (plotW * i / (labels.length - 1));
        ctx.fillText(label, x - 8, pad.t + plotH + 22);
      });

      series.forEach(s => {
        ctx.strokeStyle = s.color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        s.data.forEach((val, i) => {
          const x = pad.l + (plotW * i / (labels.length - 1));
          const y = pad.t + plotH * (1 - (val - yMin) / (yMax - yMin));
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();

        ctx.fillStyle = s.color;
        s.data.forEach((val, i) => {
          const x = pad.l + (plotW * i / (labels.length - 1));
          const y = pad.t + plotH * (1 - (val - yMin) / (yMax - yMin));
          ctx.beginPath();
          ctx.arc(x, y, 2.5, 0, Math.PI * 2);
          ctx.fill();
        });
      });

      let lx = pad.l;
      const ly = 12;
      ctx.font = "12px 'Space Grotesk', system-ui, sans-serif";
      series.forEach((s, i) => {
        const x = lx + i * 70;
        ctx.fillStyle = s.color;
        ctx.fillRect(x, ly - 8, 10, 10);
        ctx.fillStyle = "#111827";
        ctx.fillText(s.name, x + 14, ly + 1);
      });
    }

    function drawBars(ctx, width, height, items){
      if (!items.length) return;
      const pad = { l: 54, r: 16, t: 20, b: 32 };
      const plotW = width - pad.l - pad.r;
      const plotH = height - pad.t - pad.b;
      const maxVal = Math.max(...items.map(i => i.value));
      const yMax = Math.ceil(maxVal / 10000) * 10000;
      const gridCount = 4;

      ctx.font = "11px 'Space Grotesk', system-ui, sans-serif";
      ctx.fillStyle = "#6b7280";
      ctx.strokeStyle = "rgba(148,163,184,.35)";
      ctx.lineWidth = 1;
      for (let i = 0; i <= gridCount; i++){
        const t = i / gridCount;
        const y = pad.t + plotH * (1 - t);
        ctx.beginPath();
        ctx.moveTo(pad.l, y);
        ctx.lineTo(pad.l + plotW, y);
        ctx.stroke();
        const val = Math.round(yMax * t);
        ctx.fillText(formatNum(val), 6, y + 4);
      }

      const gap = 16;
      const barW = (plotW - gap * (items.length - 1)) / items.length;
      ctx.font = "12px 'Space Grotesk', system-ui, sans-serif";
      items.forEach((item, i) => {
        const x = pad.l + i * (barW + gap);
        const barH = plotH * (item.value / yMax);
        const y = pad.t + plotH - barH;
        ctx.fillStyle = item.color;
        ctx.fillRect(x, y, barW, barH);
        ctx.fillStyle = "#111827";
        ctx.fillText(item.label, x, pad.t + plotH + 22);
        ctx.fillText(formatNum(item.value), x, y - 6);
      });
    }

    function attachCanvasLightbox(canvas, label){
      if (!canvas) return;
      canvas.addEventListener("click", () => {
        const dataUrl = canvas.toDataURL("image/png");
        openLightbox(dataUrl, label || "chart");
      });
    }

    function openLightbox(src, alt){
      if (!lightboxEl || !lightboxImgEl) return;
      lightboxImgEl.src = src;
      lightboxImgEl.alt = alt || "image";
      lightboxEl.classList.add("open");
      lightboxEl.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function closeLightbox(){
      if (!lightboxEl || !lightboxImgEl) return;
      lightboxEl.classList.remove("open");
      lightboxEl.setAttribute("aria-hidden", "true");
      lightboxImgEl.src = "";
      lightboxImgEl.alt = "";
      document.body.style.overflow = "";
    }

    function renderSlide(s){
      titleEl.innerHTML = s.title;
      subtitleEl.textContent = s.subtitle || "";

      if (s.callout && s.callout.trim()){
        calloutEl.style.display = "";
        calloutEl.textContent = s.callout;
      } else {
        calloutEl.style.display = "none";
        calloutEl.textContent = "";
      }

      if (s.extra){
        const extraBullets = (s.extra.bullets || []).map(x => `<li>${escapeHtml(x)}</li>`).join("");
        extraEl.innerHTML = `
          <div class="extra-title">${escapeHtml(s.extra.title)}</div>
          <div class="extra-sub">${escapeHtml(s.extra.subtitle)}</div>
          <ul class="extra-list">${extraBullets}</ul>
        `;
        extraEl.style.display = "";
      } else {
        extraEl.style.display = "none";
        extraEl.innerHTML = "";
      }

      // ✅ COVER MODE
      if (s.isCover){
        coverAreaEl.style.display = "";
        mainGridEl.style.display = "none";

        // Button goes to "Who we are" (index 1)
        $("#btnStart").onclick = () => setSlide(1);

        // Still show dots and tabs highlighting
        slideIndexEl.textContent = `Slide ${idx+1} / ${SLIDES.length}`;
        [...progressEl.children].forEach((d,i)=> d.classList.toggle("active", i===idx));
        setActiveTabs(s.tab);

        // Disable Prev on cover
        $("#btnPrev").disabled = true;
        $("#btnPrev").style.opacity = 0.5;

        return;
      }

      // ✅ NORMAL MODE
      coverAreaEl.style.display = "none";
      mainGridEl.style.display = "";

      $("#btnPrev").disabled = false;
      $("#btnPrev").style.opacity = 1;

      const hideRightPanel = !!s.imageOnly || !!s.hideRightPanel;
      if (hideRightPanel){
        mainGridEl.classList.add("single");
        if (rightPanelEl) rightPanelEl.style.display = "none";
      } else {
        mainGridEl.classList.remove("single");
        if (rightPanelEl) rightPanelEl.style.display = "";
      }

      leftTagEl.textContent = s.leftTag || "Overview";
      rightTagEl.textContent = s.rightTag || "Evidence";

      const leftImages = Array.isArray(s.leftImages)
        ? s.leftImages
        : (s.leftImage ? [s.leftImage] : []);
      const cleanLeftImages = leftImages.filter(img => img && img.src && String(img.src).trim());
      const hasLeftImage = cleanLeftImages.length > 0;
      bulletsEl.innerHTML = "";
      statsEl.innerHTML = "";
      growthEl.innerHTML = "";
      growthEl.style.display = "none";
      gapsEl.innerHTML = "";
      gapsEl.style.display = "none";
      leftMediaEl.innerHTML = "";

      if (hasLeftImage){
        const slideKey = s.id || String(idx);
        if (leftMediaIndex[slideKey] == null || leftMediaIndex[slideKey] >= cleanLeftImages.length){
          leftMediaIndex[slideKey] = 0;
        }
        const current = cleanLeftImages[leftMediaIndex[slideKey]];
        if (leftTitleWrapEl) leftTitleWrapEl.style.display = "none";
        bulletsEl.style.display = "none";
        statsEl.style.display = "none";
        growthEl.style.display = "none";
        gapsEl.style.display = "none";
        leftMediaEl.style.display = "";
        leftMediaEl.innerHTML = `<img src="${escapeHtml(current.src)}" alt="${escapeHtml(current.alt || "left image")}">`;
        const leftImgEl = leftMediaEl.querySelector("img");
        if (leftImgEl){
          leftImgEl.loading = "lazy";
          leftImgEl.addEventListener("click", () => openLightbox(current.src, current.alt || "left image"));
        }
        if (cleanLeftImages.length > 1){
          leftMediaEl.innerHTML += `<button class="left-media-next" type="button" aria-label="Next image">&gt;</button>`;
          const nextBtn = leftMediaEl.querySelector(".left-media-next");
          if (nextBtn){
            nextBtn.addEventListener("click", () => {
              leftMediaIndex[slideKey] = (leftMediaIndex[slideKey] + 1) % cleanLeftImages.length;
              renderSlide(s);
            });
          }
        }
      } else {
        if (leftTitleWrapEl) leftTitleWrapEl.style.display = "";
        leftMediaEl.style.display = "none";

        const hasBenchmark = Array.isArray(s.benchmarkItems) && s.benchmarkItems.length > 0;
        if (hasBenchmark){
          const slideKey = s.id || String(idx);
          if (benchIndex[slideKey] == null || benchIndex[slideKey] >= s.benchmarkItems.length){
            benchIndex[slideKey] = 0;
          }
          const items = s.benchmarkItems;
          const current = items[benchIndex[slideKey]];
          const buttons = items.map((it, i) => `
            <button class="bench-item${i === benchIndex[slideKey] ? " active" : ""}" data-idx="${i}" aria-label="${escapeHtml(it.title)}">${i + 1}</button>
          `).join("");
          const strengths = (current.strengths || []).map(x => `<li>${escapeHtml(x)}</li>`).join("");
          const limits = (current.limits || []).map(x => `<li>${escapeHtml(x)}</li>`).join("");
          benchmarkEl.innerHTML = `
            <div class="bench-list">${buttons}</div>
            <div class="bench-detail">
              <div class="bench-title">${escapeHtml(current.title)}</div>
              ${current.examples ? `<div class="bench-meta"><span class="muted">Examples:</span> ${escapeHtml(current.examples)}</div>` : ""}
              <div class="bench-cols">
                <div>
                  <div class="bench-sub">Strengths</div>
                  <ul class="bench-ul">${strengths}</ul>
                </div>
                <div>
                  <div class="bench-sub">Limits</div>
                  <ul class="bench-ul">${limits}</ul>
                </div>
              </div>
              ${current.note ? `<div class="bench-note">↳ ${escapeHtml(current.note)}</div>` : ""}
            </div>
          `;
          benchmarkEl.style.display = "";
          bulletsEl.style.display = "none";
          statsEl.style.display = "none";
          growthEl.style.display = "none";
          gapsEl.style.display = "none";
          const benchBtns = benchmarkEl.querySelectorAll(".bench-item");
          benchBtns.forEach(btn => {
            btn.addEventListener("click", () => {
              const nextIdx = parseInt(btn.getAttribute("data-idx"), 10);
              if (!Number.isNaN(nextIdx)){
                benchIndex[slideKey] = nextIdx;
                renderSlide(s);
              }
            });
          });
        } else {
          benchmarkEl.style.display = "none";
          bulletsEl.style.display = "";
          statsEl.style.display = "";

          (s.bullets || []).forEach(b => {
            const li = document.createElement("li");
            li.innerHTML = b;
            bulletsEl.appendChild(li);
          });

          if (s.growth){
            const rows = (s.growth.rows || []).map(r => `
              <tr>
                <td>${escapeHtml(r.year)}</td>
                <td class="growth-value">${escapeHtml(r.value)}</td>
              </tr>
            `).join("");
            growthEl.innerHTML = `
              <div class="growth-title">${escapeHtml(s.growth.title)}</div>
              <div class="growth-sub">${escapeHtml(s.growth.subtitle)}</div>
              <table class="growth-table">
                <thead>
                  <tr><th>Year</th><th>Value</th></tr>
                </thead>
                <tbody>${rows}</tbody>
              </table>
              <div class="growth-note">${escapeHtml(s.growth.note)}</div>
            `;
            growthEl.style.display = "";
          }

          const hasTrustGaps = Array.isArray(s.trustGaps) && s.trustGaps.length > 0;
          if (hasTrustGaps){
            gapsEl.innerHTML = s.trustGaps.map(gap => `
              <div class="gap-card">
                <div class="gap-title">${escapeHtml(gap.title)}</div>
                <div class="gap-value">${escapeHtml(gap.value)}</div>
                <div class="gap-note">${escapeHtml(gap.note)}</div>
              </div>
            `).join("");
            gapsEl.style.display = "";
            statsEl.style.display = "none";
          } else {
            gapsEl.style.display = "none";
            statsEl.style.display = "";
            (s.stats || []).forEach(st => {
              const card = document.createElement("div");
              card.className = "stat";
              card.innerHTML = `
                <div class="k">${escapeHtml(st.k)}</div>
                <div class="v">${escapeHtml(st.v)}</div>
                <div class="note">${escapeHtml(st.note || "")}</div>
              `;
              statsEl.appendChild(card);
            });
          }
        }
      }

      imagesEl.innerHTML = "";
      if (s.chart === "trend_3y"){
        imagesEl.innerHTML = `
          <div class="chart-block">
            <div class="chart-title">Monthly VP+VUL (2022–2024)</div>
            <canvas class="chart-canvas" id="trendLine"></canvas>
          </div>
          <div class="chart-block">
            <div class="chart-title">Cumul Jan→Oct (2023–2025)</div>
            <canvas class="chart-canvas bar" id="trendCumul"></canvas>
          </div>
        `;
        const trend = s.trend || {};
        const lineCanvas = $("#trendLine");
        if (lineCanvas){
          const lineCtx = setupCanvas(lineCanvas, 860, 320);
          drawLineChart(lineCtx.ctx, lineCtx.width, lineCtx.height, trend.series || [], trend.months || []);
          attachCanvasLightbox(lineCanvas, "Monthly VP+VUL (2022–2024)");
        }
        const barCanvas = $("#trendCumul");
        if (barCanvas){
          const barCtx = setupCanvas(barCanvas, 860, 240);
          drawBars(barCtx.ctx, barCtx.width, barCtx.height, trend.cumul || []);
          attachCanvasLightbox(barCanvas, "Cumul Jan–Oct (2023–2025)");
        }
      } else {
        (s.images || []).forEach((img, i) => {
          const box = document.createElement("div");
          box.className = "img";
          const frames = Array.isArray(img.frames) ? img.frames : null;
          if (frames && frames.length){
            const frameKey = `${s.id || idx}:${i}`;
            if (rightMediaIndex[frameKey] == null || rightMediaIndex[frameKey] >= frames.length){
              rightMediaIndex[frameKey] = 0;
            }
            const frame = frames[rightMediaIndex[frameKey]];
            if (frame.chart){
              box.classList.add("chart");
              const canvas = document.createElement("canvas");
              box.appendChild(canvas);
              const trend = s.trend || {};
              const size = setupCanvas(canvas, 860, 320);
              canvas.style.height = "100%";
              if (frame.chart === "trend_line"){
                drawLineChart(size.ctx, size.width, size.height, trend.series || [], trend.months || []);
              } else if (frame.chart === "trend_cumul"){
                drawBars(size.ctx, size.width, size.height, trend.cumul || []);
              }
              attachCanvasLightbox(canvas, frame.label || "chart");
            } else if (frame.src && frame.src.trim()){
              box.classList.add("clickable");
              if ((frame.label || "").toLowerCase().includes("guazi logo") || frame.src.toLowerCase().includes("guazi logo")){
                box.classList.add("is-logo");
              }
              const im = document.createElement("img");
              im.src = frame.src;
              im.alt = frame.label || "image";
              im.loading = "lazy";
              im.addEventListener("click", () => openLightbox(frame.src, frame.label || "image"));
              box.appendChild(im);
            } else {
              box.textContent = (frame.label || "Add image") + " (drop file in assets/ and set src)";
            }
            if (frames.length > 1){
              const btn = document.createElement("button");
              btn.className = "img-next";
              btn.type = "button";
              btn.setAttribute("aria-label", "Next image");
              btn.textContent = ">";
              btn.addEventListener("click", () => {
                rightMediaIndex[frameKey] = (rightMediaIndex[frameKey] + 1) % frames.length;
                renderSlide(s);
              });
              box.appendChild(btn);
            }
          } else if (img.src && img.src.trim()){
            box.classList.add("clickable");
            if ((img.label || "").toLowerCase().includes("guazi logo") || img.src.toLowerCase().includes("guazi logo")){
              box.classList.add("is-logo");
            }
            const im = document.createElement("img");
            im.src = img.src;
            im.alt = img.label || "image";
            im.loading = "lazy";
            im.addEventListener("click", () => openLightbox(img.src, img.label || "image"));
            box.appendChild(im);
          } else {
            box.textContent = (img.label || "Add image") + " (drop file in assets/ and set src)";
          }
          imagesEl.appendChild(box);
        });
      }

      sourcesEl.innerHTML = "";
      if (s.sources && s.sources.length){
        sourcesEl.innerHTML =
          `<b style="color:#111827">Sources / notes</b><br>` +
          s.sources.map(x => `• ${escapeHtml(x)}`).join("<br>");
      }

      // progress + index + tabs
      [...progressEl.children].forEach((d,i)=> d.classList.toggle("active", i===idx));
      slideIndexEl.textContent = `Slide ${idx+1} / ${SLIDES.length}`;
      setActiveTabs(s.tab);
    }

    function setSlide(i){
      idx = Math.max(0, Math.min(SLIDES.length-1, i));
      renderSlide(SLIDES[idx]);
      location.hash = `#${idx+1}`;
    }

    function next(){ setSlide(idx+1); }
    function prev(){ setSlide(idx-1); }

    // Buttons
    $("#btnNext").addEventListener("click", next);
    $("#btnPrev").addEventListener("click", prev);
    if (lightboxEl){
      lightboxEl.addEventListener("click", (e) => {
        if (e.target === lightboxEl) closeLightbox();
      });
    }
    if (lightboxCloseEl){
      lightboxCloseEl.addEventListener("click", closeLightbox);
    }

    // Keyboard
    window.addEventListener("keydown", (e)=>{
      if (lightboxEl && lightboxEl.classList.contains("open")){
        if (e.key === "Escape") closeLightbox();
        return;
      }
      if (e.key === "ArrowRight" || e.key === "PageDown") next();
      if (e.key === "ArrowLeft" || e.key === "PageUp") prev();
      if (e.key === "Home") setSlide(0);
      if (e.key === "End") setSlide(SLIDES.length-1);
    });

    // Init
    buildTabs();
    buildProgress();

    // Load from hash
    const hashNum = parseInt((location.hash || "").replace("#",""), 10);
    if (!Number.isNaN(hashNum) && hashNum>=1 && hashNum<=SLIDES.length) {
      setSlide(hashNum-1);
    } else {
      setSlide(0); // ✅ Start with cover
    }
  </script>
</body>
</html>
